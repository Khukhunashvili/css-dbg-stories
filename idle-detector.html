<!DOCTYPE html>
<meta http-equiv="origin-trial" content="AguTVwSEBWefpr8EO7VDG/hIsTlPnejeHfFx7VUmYHm88rSuXnind5pGFWAsdk9YBPp7wE6AuPPUUwzgLrqoKwEAAABeeyJvcmlnaW4iOiJodHRwczovL21hdGhpYXNieW5lbnMuZ2l0aHViLmlvOjQ0MyIsImZlYXR1cmUiOiJJZGxlRGV0ZWN0aW9uIiwiZXhwaXJ5IjoxNTk4MDEwNTAwfQ==">
<title>Demo</title>
<h3>Enable the #enable-experimental-web-platform-features flag in chrome://flags</h3>
<div id="status"></div>
<div id="error"></div>
<script>
  async function main() {
    const hasPermission = await navigator.permissions.query({ name: 'notifications' });
    if (hasPermission.state !== 'granted') {
      const result = await Notification.requestPermission();
      if (result !== 'granted') {
        document.getElementById('status').appendChild(document.createTextNode('Notifications permission not granted.'));
        document.getElementById('status').appendChild(document.createElement('br'));
        return;
      }
    }
    try {
      const controller = new AbortController();
      const signal = controller.signal;
      const idleDetector = new IdleDetector({
        threshold: 60000,
        signal,
      });
      idleDetector.addEventListener('change', (e) => {
        const userState = idleDetector.userState;
        const screenState = idleDetector.screenState;
        document.getElementById('status').appendChild(document.createTextNode(`Idle change: ${userState}, ${screenState}.`));
        document.getElementById('status').appendChild(document.createElement('br'));
      });
      await idleDetector.start();
      document.getElementById('status').appendChild(document.createTextNode('Idle detector started'));
      document.getElementById('status').appendChild(document.createElement('br'));
    } catch (e) {
      document.getElementById('error').appendChild(document.createTextNode(e.message));
      document.getElementById('error').appendChild(document.createElement('br'));
    }
  }
  main();
</script>
